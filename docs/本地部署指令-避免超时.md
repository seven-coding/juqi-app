# 本地部署指令（避免超时）

在**本机终端**执行以下命令，可分段部署、避免单次执行过长导致超时。

---

## 一、云函数（测试环境）

工作目录：`JUQI-APP/cloudfunctions`，需已配置 `.env` 或 `apiServer/.env`（含 `TENCENT_SECRET_ID` / `TENCENT_SECRET_KEY` 或 `CLOUD_BASE_ID` / `CLOUD_BASE_KEY`）。

### 1. 只部署 appApi（最快，约 1～2 分钟）

```bash
cd /Users/tongyao/Desktop/Code/JUQI/JUQI-APP/cloudfunctions
DEPLOY_ONLY=appApi node run-full-deploy.js
```

适用于：只改了 appApi（登录、用户、动态等 v2 接口）时使用。

### 2. 按需部署多个函数（逗号分隔，无空格）

```bash
cd /Users/tongyao/Desktop/Code/JUQI/JUQI-APP/cloudfunctions
DEPLOY_ONLY=appApi,getDynsListV2,getDynDetail node run-full-deploy.js
```

### 3. 全量部署（22 个函数，建议本机跑，约 10～15 分钟）

```bash
cd /Users/tongyao/Desktop/Code/JUQI/JUQI-APP/cloudfunctions
node run-full-deploy.js
```

若仍担心超时，可分两次跑（先一半函数名，再另一半），例如：

```bash
# 第一批
DEPLOY_ONLY=appApi,getDynsListV2,getDynDetail,publishDyn,likeOrUnlikeV2,delDyn,getMessagesNew,setMessage,getCircle,getCircleDetail node run-full-deploy.js

# 第二批（等第一批完成后再执行）
DEPLOY_ONLY=getTopic,setTopic,setJoinCircle,getRearch,login,commonRequest,getUserAbout,chargeHer,setUser,updateUserInfo,getUserList,setUserInfo node run-full-deploy.js
```

---

## 二、API 服务（CloudRun / 云托管）

工作目录：`JUQI-APP/apiServer`。部署前需已登录 CloudBase CLI（`tcb login`）。

### 1. 构建 + 部署（需在本地终端执行，避免 IDE 超时）

```bash
cd /Users/tongyao/Desktop/Code/JUQI/JUQI-APP/apiServer
npm run build
tcb framework deploy
```

部署时会提示确认，输入 `y` 回车即可。

### 2. 跳过确认（非交互，适合脚本/CI）

```bash
cd /Users/tongyao/Desktop/Code/JUQI/JUQI-APP/apiServer
npm run build
echo y | tcb framework deploy
```

---

## 三、常用组合

- **只改了登录/接口逻辑（appApi）**：执行「一、1」即可。
- **只改了 Nest 网关（apiServer）」**：执行「二」。
- **两者都改了**：先执行「一、1」，再执行「二」。

所有命令均在**本机终端**运行，不依赖 Cursor 内置终端超时限制。
