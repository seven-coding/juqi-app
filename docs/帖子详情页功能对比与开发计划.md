# 帖子详情页功能对比与开发计划

## 一、功能对比表

| 功能模块 | 小程序 | iOS当前状态 | 优先级 | 备注 |
|---------|--------|------------|--------|------|
| **基础信息展示** |
| 用户信息区 | ✅ 完整 | ✅ 已实现 | - | 头像、昵称、签名、VIP标识 |
| 圈子信息 | ✅ 显示圈子名称和参与人数 | ❌ 未实现 | P1 | 需要显示圈子标签和参与人数 |
| 帖子标签 | ✅ 显示 | ✅ 已实现 | - | 日常/热榜等标签 |
| **内容展示** |
| 文字内容 | ✅ 支持 | ✅ 已实现 | - | 富文本支持 |
| 图片展示 | ✅ 支持1-9张 | ✅ 已实现 | - | 支持多图预览 |
| 语音条 | ✅ 支持播放 | ❌ 未实现 | P2 | 需要音频播放组件 |
| 视频播放 | ✅ 支持+弹幕 | ❌ 未实现 | P2 | 需要视频播放器+弹幕功能 |
| 音频/音乐 | ✅ 支持播放 | ❌ 未实现 | P2 | 需要音频播放组件 |
| 转发内容 | ✅ 支持显示 | ❌ 未实现 | P1 | 需要显示转发原帖内容 |
| 话题标签 | ✅ 可点击跳转 | ⚠️ 部分支持 | P1 | 需要实现话题跳转功能 |
| @用户 | ✅ 可点击跳转 | ⚠️ 部分支持 | P1 | 需要实现@用户跳转功能 |
| **互动功能** |
| 点赞/放电 | ✅ 支持+用户列表 | ✅ 已实现 | - | 显示互动用户头像 |
| 点赞展开/收起 | ✅ 支持 | ❌ 未实现 | P2 | 用户列表展开/收起功能 |
| 评论系统 | ✅ 完整二级评论 | ❌ 未实现 | P0 | **核心功能缺失** |
| 评论点赞 | ✅ 支持 | ❌ 未实现 | P0 | 评论的点赞功能 |
| 评论@用户 | ✅ 支持 | ❌ 未实现 | P0 | 评论中@其他用户 |
| 评论图片 | ✅ 支持上传 | ❌ 未实现 | P0 | 评论可带图片 |
| 转发功能 | ✅ 支持 | ⚠️ 仅按钮 | P1 | 需要实现转发逻辑 |
| 充电功能 | ✅ 支持 | ✅ 已实现 | - | 电池图标 |
| 关注功能 | ✅ 支持 | ❌ 未实现 | P1 | 关注/取消关注按钮 |
| **评论输入** |
| 评论输入框 | ✅ 完整功能 | ❌ 未实现 | P0 | **核心功能缺失** |
| 文字输入 | ✅ 支持 | ❌ 未实现 | P0 | 基础输入功能 |
| 图片上传 | ✅ 支持 | ❌ 未实现 | P0 | 评论图片上传 |
| 表情选择 | ✅ 支持 | ❌ 未实现 | P2 | 表情选择器 |
| @用户选择 | ✅ 支持 | ❌ 未实现 | P0 | @用户功能 |
| 回复评论 | ✅ 支持 | ❌ 未实现 | P0 | 回复一级/二级评论 |
| **帖子操作** |
| 更多操作菜单 | ✅ 支持 | ❌ 未实现 | P1 | 分享、举报、删除等 |
| 复制文本 | ✅ 支持 | ❌ 未实现 | P2 | 长按复制功能 |
| 分享功能 | ✅ 支持 | ❌ 未实现 | P2 | 分享到其他平台 |
| 帖子管理 | ✅ 完整 | ❌ 未实现 | P3 | 管理员功能 |
| 操作记录 | ✅ 支持查看 | ❌ 未实现 | P3 | 管理员查看操作历史 |
| **权限与验证** |
| 新人验证 | ✅ 弹窗提示 | ❌ 未实现 | P2 | 新人区验证逻辑 |
| 会员弹窗 | ✅ 支持 | ❌ 未实现 | P2 | VIP相关功能 |
| 授权申请 | ✅ 支持 | ❌ 未实现 | P3 | 内容授权功能 |
| 风险控制 | ✅ 显示风险提示 | ❌ 未实现 | P2 | 风险等级显示 |
| **其他功能** |
| 加载状态 | ✅ 支持 | ✅ 已实现 | - | 加载动画 |
| 错误处理 | ✅ 完整 | ⚠️ 基础 | P1 | 错误提示和重试 |
| 下拉刷新 | ✅ 支持 | ❌ 未实现 | P2 | 刷新帖子数据 |

## 二、开发计划

### 阶段一：核心功能（P0）- 预计3-4周

#### 1.1 评论系统（2周）
- [ ] **评论列表展示**
  - 实现一级评论列表
  - 实现二级评论（回复）展示
  - 评论布局和样式
  - 评论用户信息展示（头像、昵称、时间）
  
- [ ] **评论交互**
  - 评论点赞/取消点赞
  - 点击评论回复
  - 评论@用户显示和跳转
  - 评论图片展示和预览
  
- [ ] **评论数据模型**
  - 创建 `Comment` 模型
  - 创建 `CommentService` API服务
  - 实现评论列表获取接口
  - 实现评论点赞接口

#### 1.2 评论输入功能（1.5周）
- [ ] **输入框组件**
  - 创建 `CommentInputView` 组件
  - 文字输入功能
  - 输入框焦点管理
  - 键盘弹出/收起动画
  
- [ ] **评论提交**
  - 一级评论提交
  - 二级评论（回复）提交
  - 评论@用户功能
  - 评论图片上传和提交
  
- [ ] **输入辅助功能**
  - @用户选择器（可选，先实现基础输入）
  - 表情选择器（可选，先实现基础输入）

#### 1.3 评论API集成（0.5周）
- [ ] 实现 `getDynComment` API
- [ ] 实现 `commentV2` API
- [ ] 实现评论点赞API
- [ ] 错误处理和加载状态

### 阶段二：重要功能（P1）- 预计2-3周

#### 2.1 圈子信息展示（0.5周）
- [ ] 在用户信息区下方添加圈子信息
- [ ] 显示圈子名称（可点击跳转）
- [ ] 显示参与人数（"与 X 个橘友一起记录"）
- [ ] 圈子标签样式

#### 2.2 转发功能完善（1周）
- [ ] 转发内容展示
  - 显示转发原帖内容
  - 转发原帖图片（缩略图）
  - 转发原帖用户信息
- [ ] 转发操作
  - 转发按钮功能完善
  - 转发确认弹窗
  - 转发成功反馈

#### 2.3 话题和@用户跳转（0.5周）
- [ ] 话题标签点击跳转
  - 创建 `TopicDetailView`
  - 话题详情页实现
- [ ] @用户点击跳转
  - 优化现有用户跳转逻辑
  - 确保所有@用户都可跳转

#### 2.4 关注功能（0.5周）
- [ ] 关注/取消关注按钮
- [ ] 关注状态显示
- [ ] 关注API集成
- [ ] 关注成功/失败反馈

#### 2.5 更多操作菜单（0.5周）
- [ ] 创建操作菜单组件
- [ ] 分享功能
- [ ] 举报功能
- [ ] 删除功能（本人帖子）
- [ ] 菜单样式和动画

### 阶段三：增强功能（P2）- 预计2-3周

#### 3.1 多媒体内容支持（2周）
- [ ] **语音条播放**
  - 创建 `VoicePlayerView` 组件
  - 音频播放控制
  - 播放进度显示
  - 播放状态管理
  
- [ ] **视频播放**
  - 创建 `VideoPlayerView` 组件
  - 视频播放器集成
  - 播放控制（播放/暂停/全屏）
  - 弹幕功能（可选，先实现基础播放）
  
- [ ] **音频/音乐播放**
  - 创建 `MusicPlayerView` 组件
  - 音乐播放控制
  - 播放列表管理
  - 播放状态同步

#### 3.2 点赞列表展开/收起（0.5周）
- [ ] 实现用户列表折叠功能
- [ ] 展开/收起按钮
- [ ] 动画效果

#### 3.3 输入增强功能（0.5周）
- [ ] 表情选择器
  - 创建 `EmojiPickerView`（可复用发布页的）
  - 表情插入功能
- [ ] @用户选择器优化
  - 用户搜索功能
  - 用户列表展示

#### 3.4 其他功能（0.5周）
- [ ] 复制文本功能（长按复制）
- [ ] 下拉刷新功能
- [ ] 错误处理优化
- [ ] 新人验证弹窗（如需要）

### 阶段四：高级功能（P3）- 预计1-2周

#### 4.1 帖子管理功能（管理员）
- [ ] 帖子操作记录查看
- [ ] 帖子管理操作（屏蔽、删除、风险控制）
- [ ] 修改所属圈子
- [ ] 授权申请功能

#### 4.2 其他优化
- [ ] 性能优化
- [ ] 动画优化
- [ ] 用户体验优化

## 三、技术实现要点

### 3.1 评论系统架构

```
PostDetailView
├── CommentListView (评论列表)
│   ├── CommentItemView (一级评论)
│   │   ├── CommentHeaderView (用户信息)
│   │   ├── CommentContentView (评论内容)
│   │   └── ReplyListView (二级评论列表)
│   │       └── ReplyItemView (二级评论)
│   └── CommentLikeButton (评论点赞按钮)
└── CommentInputView (评论输入框)
    ├── TextInputView (文字输入)
    ├── ImagePickerView (图片选择)
    └── EmojiPickerView (表情选择)
```

### 3.2 数据模型

```swift
struct Comment: Identifiable, Codable {
    let id: String
    let postId: String
    let userId: String
    let userName: String
    let userAvatar: String?
    let content: String
    let imagePath: String?
    let publishTime: Date
    let likeCount: Int
    let isLiked: Bool
    let replies: [Comment]? // 二级评论
    let mentionedUsers: [MentionedUser]? // @的用户列表
}

struct MentionedUser: Codable {
    let id: String
    let userName: String
}
```

### 3.3 API接口

```swift
// APIService.swift 扩展
func getDynComment(postId: String, page: Int = 1, limit: Int = 20) async throws -> CommentListResponse
func submitComment(postId: String, content: String, imagePath: String?, replyTo: String?, mentionedUsers: [String]?) async throws -> CommentResponse
func likeComment(commentId: String, postId: String) async throws -> EmptyResponse
```

## 四、开发优先级说明

- **P0（核心功能）**：必须实现，否则功能不完整
- **P1（重要功能）**：影响用户体验，应尽快实现
- **P2（增强功能）**：提升体验，可逐步实现
- **P3（高级功能）**：特殊场景需求，可延后实现

## 五、预计总工时

- 阶段一（P0）：3-4周
- 阶段二（P1）：2-3周
- 阶段三（P2）：2-3周
- 阶段四（P3）：1-2周

**总计：8-12周**

## 六、注意事项

1. **评论系统是核心**：必须先完成评论功能，其他功能可以逐步添加
2. **API对接**：确保与后端API接口保持一致
3. **数据同步**：评论、点赞等操作需要实时更新UI
4. **错误处理**：所有网络请求都需要完善的错误处理
5. **性能优化**：评论列表可能很长，需要优化滚动性能
6. **用户体验**：保持与小程序版本交互体验一致
