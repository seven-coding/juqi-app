# 更新记录管理指南

本文档说明 JUQI App 项目中的更新记录管理体系和使用方法。

---

## 一、文档体系说明

项目采用多层次的更新记录管理体系，各文档职责如下：

### 1. CHANGELOG.md（更新日志）
- **位置**: 项目根目录 `/CHANGELOG.md`
- **用途**: 面向用户和开发者的正式版本更新记录
- **更新时机**: 每次代码变更提交前
- **格式**: 遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) 规范
- **内容**: 功能新增、变更、修复等重要变更

### 2. 版本与进度.md
- **位置**: `/docs/版本与进度.md`
- **用途**: 项目管理文档，跟踪功能开发进度
- **更新时机**: 功能状态变化时
- **内容**: 功能清单、完成状态、遗留问题

### 3. 日复盘.md
- **位置**: `/docs/日复盘.md`
- **用途**: 每日工作日志和总结
- **更新时机**: 每日工作结束时
- **内容**: 今日完成、明日待办、工作总结

### 4. Git Commit
- **位置**: Git 提交历史
- **用途**: 代码级变更记录
- **更新时机**: 每次代码提交
- **内容**: 具体的代码变更和提交说明

---

## 二、CHANGELOG.md 使用指南

### 2.1 何时更新

**必须更新的情况**：
- ✅ 添加新功能
- ✅ 修改现有功能
- ✅ 修复 Bug
- ✅ 更新接口
- ✅ 删除功能
- ✅ 安全修复
- ✅ 配置变更（影响用户的）

**可以不更新的情况**：
- ❌ 纯代码重构（不影响功能）
- ❌ 注释修改
- ❌ 文档错别字修正
- ❌ 临时调试代码
- ❌ 开发环境配置

### 2.2 更新流程

#### 步骤 1: 确定变更类型

选择最合适的变更类型：

| 类型 | 英文 | 使用场景 | 示例 |
|------|------|---------|------|
| 新增 | Added | 新功能、新接口、新文件 | 新增评论功能 |
| 变更 | Changed | 功能改进、参数调整 | 优化首页加载速度 |
| 修复 | Fixed | Bug 修复 | 修复登录崩溃问题 |
| 移除 | Removed | 删除功能 | 移除旧版接口 |
| 弃用 | Deprecated | 即将移除的功能 | 弃用 getUserInfo v1 |
| 安全 | Security | 安全修复 | 修复 Token 验证漏洞 |
| 待完成 | Pending | 未完成的工作 | 待联调的评论功能 |

#### 步骤 2: 编写变更描述

**编写原则**：
- 使用中英文双语
- 简洁明了，一行一条
- 突出重点变更
- 必要时注明模块或文件名
- 用户视角描述（不要太技术化）

**好的例子** ✅：
```markdown
### 新增 (Added)
- iOS: 评论列表支持一级/二级回复展示
- appApi: 新增评论点赞接口 `appLikeComment`
- 用户主页: 显示用户的关注数和粉丝数

### 变更 (Changed)
- 首页: 优化动态列表加载性能，支持预加载
- PostDetailView: 改进图片查看体验，支持双击放大
```

**不好的例子** ❌：
```markdown
### 新增 (Added)
- 添加了一些代码
- 修改了几个文件
- 更新了接口
```

#### 步骤 3: 更新 CHANGELOG.md

在 `[未发布 / Unreleased]` 部分添加变更：

```markdown
## [未发布 / Unreleased]

### 新增 (Added)
- 你的新增内容

### 变更 (Changed)
- 你的变更内容

### 修复 (Fixed)
- 你的修复内容
```

#### 步骤 4: 提交代码

确保 CHANGELOG.md 的更新和代码变更在同一次提交中。

### 2.3 使用辅助工具

项目提供了辅助脚本来简化更新流程：

```bash
# 运行 CHANGELOG 更新助手
./scripts/update-changelog.sh
```

脚本功能：
1. 查看当前 Unreleased 部分内容
2. 查看模板和更新指南
3. 打开 CHANGELOG.md 进行编辑
4. 验证 CHANGELOG.md 格式
5. 显示最近的提交信息

### 2.4 发布新版本

当准备发布新版本时：

#### 步骤 1: 确定版本号

遵循[语义化版本](https://semver.org/lang/zh-CN/)规则：

- **修订号 +1** (如 0.1.0 → 0.1.1)
  - Bug 修复
  - 小改进
  - 不影响 API

- **次版本号 +1** (如 0.1.0 → 0.2.0)
  - 新功能添加
  - 向后兼容的改进
  - 功能增强

- **主版本号 +1** (如 0.1.0 → 1.0.0)
  - 重大功能更新
  - 破坏性变更
  - 架构重构

#### 步骤 2: 更新版本号

将 `[未发布 / Unreleased]` 改为版本号和日期：

```markdown
## [0.2.0] - 2025-02-15
```

#### 步骤 3: 创建新的 Unreleased 部分

在文件顶部添加新的空白 Unreleased 部分：

```markdown
## [未发布 / Unreleased]

### 新增 (Added)

### 变更 (Changed)

### 修复 (Fixed)
```

#### 步骤 4: 提交和标记

```bash
# 提交 CHANGELOG 更新
git add CHANGELOG.md
git commit -m "chore: release version 0.2.0"

# 创建版本标签
git tag -a v0.2.0 -m "Release version 0.2.0"

# 推送到远程
git push origin main --tags
```

---

## 三、实际示例

### 示例 1: 新增功能

假设你添加了评论功能：

```markdown
## [未发布 / Unreleased]

### 新增 (Added)
- iOS: 帖子详情页支持发表评论
- iOS: 评论列表支持一级/二级回复展示
- appApi: 新增 `appCommentDyn` 评论发布接口
- appApi: 新增 `appGetDynComment` 获取评论列表接口
- appApi: 新增 `appLikeComment` 评论点赞接口
- 文档: 评论功能完整接口文档和使用说明
```

### 示例 2: Bug 修复

假设你修复了一些问题：

```markdown
## [未发布 / Unreleased]

### 修复 (Fixed)
- 修复评论图片上传后无法显示的问题
- 修复评论点赞状态在刷新后丢失的问题
- 修复二级回复数量显示错误的问题
- 修复长文本评论显示不全的问题
```

### 示例 3: 功能改进

假设你优化了性能：

```markdown
## [未发布 / Unreleased]

### 变更 (Changed)
- PostDetailView: 优化评论加载性能，支持分页和懒加载
- appGetDynComment: 增加缓存机制，减少数据库查询
- 评论列表: 改进图片加载策略，支持渐进式加载
- HomeView: 优化首页动态列表滚动性能
```

### 示例 4: 综合更新

一次提交包含多种变更：

```markdown
## [未发布 / Unreleased]

### 新增 (Added)
- iOS: 用户主页显示关注数和粉丝数
- appApi: 新增 `appGetUserFollowStatus` 获取关注状态接口

### 变更 (Changed)
- UserProfileView: 优化界面布局，增加关注/粉丝入口
- appGetUserProfile: 返回数据中增加关注统计信息

### 修复 (Fixed)
- 修复用户主页头像加载失败的问题
- 修复关注按钮状态显示不正确的问题
```

---

## 四、最佳实践

### 4.1 提交前检查清单

在提交代码前，确保：

- [ ] 代码变更已完成并测试通过
- [ ] CHANGELOG.md 已更新（在 Unreleased 部分）
- [ ] 变更描述清晰准确
- [ ] 变更类型正确
- [ ] 使用了中英文双语
- [ ] 相关文档已同步更新
- [ ] Git 提交信息与 CHANGELOG 一致

### 4.2 编写技巧

**1. 按用户视角描述**
- ✅ 好：用户主页显示关注数和粉丝数
- ❌ 差：在 UserProfileView.swift 的第 123 行添加了代码

**2. 突出价值和影响**
- ✅ 好：优化首页加载速度，减少 50% 加载时间
- ❌ 差：修改了一些代码

**3. 相关变更分组**
- ✅ 好：将同一功能的多个变更写在一起
- ❌ 差：零散地分散在不同类型中

**4. 必要时添加上下文**
- ✅ 好：修复评论图片上传后无法显示的问题（影响 iOS 14+）
- ❌ 差：修复图片问题

### 4.3 常见错误

**1. 忘记更新 CHANGELOG**
- 问题：提交代码但不更新 CHANGELOG
- 解决：养成习惯，代码和文档一起提交

**2. 描述过于技术化**
- 问题：使用太多技术术语
- 解决：用用户能理解的语言描述

**3. 缺少重要信息**
- 问题：只写"修复bug"没有说明是什么bug
- 解决：明确说明问题和影响范围

**4. 变更类型错误**
- 问题：把新功能放在 Changed 而不是 Added
- 解决：参考类型定义，选择最合适的类型

---

## 五、工具和资源

### 5.1 辅助脚本

```bash
# 更新 CHANGELOG 助手
./scripts/update-changelog.sh
```

### 5.2 模板文件

- `/docs/CHANGELOG模板.md` - 更新模板和详细指南

### 5.3 参考文档

- [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) - CHANGELOG 格式规范
- [语义化版本](https://semver.org/lang/zh-CN/) - 版本号规范
- [开发指南](./开发指南.md) - 项目开发规范

### 5.4 相关文档

- [CHANGELOG.md](../CHANGELOG.md) - 项目更新日志
- [版本与进度.md](./版本与进度.md) - 功能进度跟踪
- [日复盘.md](./日复盘.md) - 每日工作日志

---

## 六、常见问题

### Q1: 每次都要更新 CHANGELOG 吗？

A: 不是每次都要，但建议在以下情况更新：
- 完成一个功能点
- 修复一个bug
- 做了重要的改进
- 准备提交PR之前

小的代码调整（如重构、注释）可以不记录。

### Q2: Unreleased 部分太长怎么办？

A: 这说明该发布新版本了！将 Unreleased 内容移到新版本号下，创建发布。

### Q3: 如何处理多人协作的 CHANGELOG？

A: 
- 每个人负责更新自己的变更
- 合并时解决冲突，保持格式一致
- 定期整理，避免重复内容

### Q4: 写错了怎么办？

A: 
- 如果还没推送：直接修改 CHANGELOG.md
- 如果已经推送：在下次更新时修正
- 已发布的版本：在新版本的 Changed 中说明

### Q5: 如何知道该用哪个版本号？

A: 参考语义化版本规则：
- 修bug → 修订号 +1
- 加功能 → 次版本号 +1
- 大改版 → 主版本号 +1

---

## 七、总结

良好的更新记录管理可以：
- ✅ 让团队成员了解项目进展
- ✅ 帮助用户了解新功能和修复
- ✅ 便于回溯和问题排查
- ✅ 提升项目专业度

记住：**每次更新，都补充下更新记录** 📝
