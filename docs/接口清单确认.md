# App接口清单确认文档

## 一、接口清单总览

### 接口统计
- **总接口数**: 34个
- **需要Token**: 31个
- **无需Token**: 3个
- **返回会员状态**: 4个

### 架构说明
- **架构方案**: 版本控制方案（业务版本层处理差异，核心层保持纯净）
- **接口入口**: `appApi`云函数统一入口
- **参数处理**: App版本通过Token解析openId，核心层统一接收标准化参数
- **隔离方式**: 版本层处理所有App特有逻辑，不传递source参数

## 二、接口分类清单

### 2.1 用户认证类（3个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 1 | appLogin | App登录 | 否 | 是 |
| 2 | appGetUserInfo | 获取用户信息 | 是 | 是 |
| 3 | appRefreshToken | 刷新Token | 是 | 否 |

### 2.2 用户信息类（4个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 4 | appGetCurrentUser | 获取当前用户信息 | 是 | 是 |
| 5 | appGetUserProfile | 获取用户主页信息 | 是 | 是（仅自己） |
| 6 | appUpdateUserInfo | 更新用户信息 | 是 | 否 |
| 7 | appGetUserStats | 获取用户统计数据 | 是 | 否 |

### 2.3 动态类（7个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 8 | appGetDynList | 获取动态列表 | 是 | 否 |
| 9 | appGetDynDetail | 获取动态详情 | 是 | 否 |
| 10 | appPublishDyn | 发布动态 | 是 | 否 |
| 11 | appDeleteDyn | 删除动态 | 是 | 否 |
| 12 | appLikeDyn | 点赞动态 | 是 | 否 |
| 13 | appCommentDyn | 评论动态 | 是 | 否 |
| 14 | appGetComments | 获取评论列表 | 是 | 否 |

### 2.4 圈子类（5个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 15 | appGetCircleList | 获取圈子列表 | 是 | 否 |
| 16 | appGetCircleDetail | 获取圈子详情 | 是 | 否 |
| 17 | appJoinCircle | 加入圈子 | 是 | 否 |
| 18 | appQuitCircle | 退出圈子 | 是 | 否 |
| 19 | appGetCircleMembers | 获取圈子成员 | 是 | 否 |

### 2.5 消息类（5个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 20 | appGetMessageList | 获取消息列表 | 是 | 否 |
| 21 | appGetChatHistory | 获取聊天记录 | 是 | 否 |
| 22 | appSendMessage | 发送消息 | 是 | 否 |
| 23 | appMarkMessageRead | 标记消息已读 | 是 | 否 |
| 24 | appGetUnreadCount | 获取未读消息数 | 是 | 否 |

### 2.6 搜索类（3个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 25 | appSearchUser | 搜索用户 | 是 | 否 |
| 26 | appSearchDyn | 搜索动态 | 是 | 否 |
| 27 | appSearchTopic | 搜索话题 | 是 | 否 |

### 2.7 文件上传类（2个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 28 | appUploadImage | 上传图片 | 是 | 否 |
| 29 | appDeleteImage | 删除图片 | 是 | 否 |

### 2.8 其他功能类（5个接口）

| 序号 | 接口名称 | 功能说明 | 需要Token | 返回会员状态 |
|------|---------|---------|----------|-------------|
| 30 | appGetTopicList | 获取话题列表 | 是 | 否 |
| 31 | appGetTopicDetail | 获取话题详情 | 是 | 否 |
| 32 | appGetConfig | 获取配置信息 | 否 | 否 |
| 33 | appFollowUser | 关注用户 | 是 | 否 |
| 34 | appUnfollowUser | 取消关注 | 是 | 否 |

## 三、接口边界确认

### 3.1 已确认包含的接口
- ✅ 用户认证相关（登录、获取用户信息）
- ✅ 用户信息相关（获取、更新用户信息）
- ✅ 动态相关（列表、详情、发布、互动）
- ✅ 圈子相关（列表、详情、加入）
- ✅ 消息相关（列表、聊天）
- ✅ 搜索相关（用户、动态、话题）
- ✅ 文件上传相关（图片上传、删除）
- ✅ 其他功能（话题、关注、配置）

### 3.2 明确不包含的接口
- ❌ 商城相关接口（App版本暂不支持）
- ❌ 游戏相关接口（App版本暂不支持）
- ❌ AI助手相关接口（App版本暂不支持）
- ❌ 管理后台相关接口（App版本暂不支持）
- ❌ 复杂活动页面接口（App版本暂不支持）
- ❌ 圈子管理接口（App版本暂不支持）
- ❌ 动态编辑接口（App版本暂不支持）

## 四、接口优先级确认

### 第一阶段：核心功能（7个接口）
1. appLogin
2. appGetUserInfo
3. appGetDynList
4. appGetDynDetail
5. appPublishDyn
6. appLikeDyn
7. appCommentDyn

### 第二阶段：重要功能（6个接口）
8. appGetCircleList
9. appGetCircleDetail
10. appJoinCircle
11. appGetMessageList
12. appSendMessage
13. appSearchUser

### 第三阶段：辅助功能（21个接口）
14-34. 其他接口根据需求逐步实现

## 五、接口命名规范确认

### 5.1 命名规则
- 所有App接口以`app`前缀开头
- 接口名称采用驼峰命名法
- 接口名称清晰表达功能

### 5.2 命名示例
- ✅ appLogin - 登录
- ✅ appGetUserInfo - 获取用户信息
- ✅ appPublishDyn - 发布动态
- ✅ appGetCircleList - 获取圈子列表

## 六、会员状态接口确认

### 6.1 返回会员状态的接口（4个）
1. appLogin - 登录时返回
2. appGetUserInfo - 获取用户信息时返回
3. appGetCurrentUser - 获取当前用户时返回
4. appGetUserProfile - 获取用户主页时返回（仅自己的信息）

### 6.2 会员状态字段位置
- 统一位置：`data.userInfo.usersSecret[0].vipStatus`
- 字段包含：vipStatus, vipStartTime, vipEndTime, vipConfig

## 七、架构实现说明

### 7.1 版本控制方案

**核心原则**：
- 业务版本层（appApi/modules）处理所有App特有逻辑
- 参数标准化：App版本通过Token解析openId，核心层统一接收标准化参数
- 不传递source参数：核心层不区分调用来源，专注于核心业务逻辑
- 数据格式转换：版本层负责将核心层返回转换为App所需格式

### 7.2 实现方式分类

**标准化调用**（大部分接口）：
- 版本层将App参数标准化后调用核心层
- 核心层接收标准化参数，执行核心业务逻辑
- 版本层将核心层返回转换为App格式

**版本层封装**（部分接口）：
- 需要组合多个核心层函数
- 需要额外业务逻辑处理
- App特有功能实现

**独立实现**（少数接口）：
- App有完全不同的业务逻辑
- 版本层直接操作数据库
- 不调用核心层

### 7.3 开发注意事项

1. **参数标准化**：版本层负责将App参数转换为核心层标准格式
2. **openId处理**：App版本通过Token解析，核心层统一接收
3. **数据转换**：版本层负责数据格式转换，适配App需求
4. **会员状态**：版本层确保会员状态正确返回
5. **错误处理**：版本层统一处理错误，转换为App格式

## 八、待确认事项

### 8.1 接口范围
- [ ] 接口清单是否完整
- [ ] 是否需要添加其他接口
- [ ] 是否需要删除某些接口

### 8.2 接口分类
- [ ] 接口分类是否合理
- [ ] 是否需要调整分类

### 8.3 接口命名
- [ ] 接口命名是否规范
- [ ] 是否需要调整命名

### 8.4 接口优先级
- [ ] 优先级划分是否合理
- [ ] 是否需要调整优先级

### 8.5 架构实现
- [ ] 版本控制方案是否理解
- [ ] 参数标准化方式是否确认
- [ ] 数据格式转换需求是否明确

## 九、确认结果

**待用户确认后填写**

- 接口清单确认：□ 已确认  □ 需要调整
- 接口分类确认：□ 已确认  □ 需要调整
- 接口命名确认：□ 已确认  □ 需要调整
- 接口优先级确认：□ 已确认  □ 需要调整
- 架构实现确认：□ 已确认  □ 需要调整

---

**说明**: 本文档用于确认接口清单和架构实现方式，确认后开始开发。

**架构方案**: 版本控制方案（业务版本层处理差异，核心层保持纯净，不传递source参数）
