# 如何获取腾讯云密钥和云开发环境ID

## 一、云开发环境ID

### 已配置的环境ID

✅ **测试环境ID**: `test-juqi-3g1m5qa7cc2737a1`

这个环境ID已经在以下文件中配置：
- `JUQI-APP/cloudfunctions/appApi/config.json`
- `JUQI-APP/cloudfunctions/appApi/tests/utils/test-helper.js`

**无需额外获取**，直接使用即可。

### 如何查看环境ID

如果需要在其他地方查看或确认环境ID：

1. **在微信开发者工具中查看**：
   - 打开微信开发者工具
   - 点击"云开发" → "设置"
   - 在"环境设置"中可以看到环境ID

2. **在云开发控制台查看**：
   - 访问：https://console.cloud.tencent.com/tcb
   - 选择对应的环境
   - 在环境概览中可以看到环境ID

---

## 二、腾讯云密钥（SecretId 和 SecretKey）

### 获取步骤

#### 方法1: 通过腾讯云控制台获取（推荐）

1. **登录腾讯云控制台**
   - 访问：https://console.cloud.tencent.com/
   - 使用你的腾讯云账号登录

2. **进入访问管理**
   - 点击右上角头像
   - 选择"访问管理" → "API密钥管理"
   - 或者直接访问：https://console.cloud.tencent.com/cam/capi

3. **创建或查看密钥**
   - 如果已有密钥：直接查看并复制 `SecretId` 和 `SecretKey`
   - 如果没有密钥：点击"新建密钥"创建新的密钥对

4. **保存密钥**
   - ⚠️ **重要**：`SecretKey` 只在创建时显示一次，请妥善保存
   - 如果丢失，需要重新创建

#### 方法2: 通过云开发控制台获取

1. **访问云开发控制台**
   - 访问：https://console.cloud.tencent.com/tcb
   - 选择对应的环境（测试环境：`test-juqi-3g1m5qa7cc2737a1`）

2. **查看环境设置**
   - 点击"环境设置" → "环境信息"
   - 可以看到环境ID和相关信息

3. **获取密钥**
   - 如果环境已关联腾讯云账号，可以在"访问管理"中获取密钥
   - 或者使用云开发提供的API Key（注意：API Key和SecretId/SecretKey是不同的）

---

## 三、配置方式

### 方式1: 在微信开发者工具中运行（最简单）

**无需配置密钥**，微信开发者工具会自动处理认证。

1. 打开微信开发者工具
2. 打开项目 `JUQI-APP`
3. 在终端运行测试：
   ```bash
   cd cloudfunctions/appApi
   node tests/run-all-tests.js
   ```

### 方式2: 本地运行（需要配置环境变量）

如果需要本地运行测试，需要配置环境变量：

#### 创建 `.env` 文件

在 `JUQI-APP/cloudfunctions/appApi/` 目录下创建 `.env` 文件：

```bash
# 云开发环境ID
TCB_ENV_ID=test-juqi-3g1m5qa7cc2737a1

# 腾讯云密钥（从控制台获取）
TENCENT_SECRET_ID=你的SecretId
TENCENT_SECRET_KEY=你的SecretKey
```

#### 修改测试代码使用环境变量

如果需要，可以修改 `tests/utils/test-helper.js`：

```javascript
cloud.init({
  env: process.env.TCB_ENV_ID || 'test-juqi-3g1m5qa7cc2737a1',
  // 如果需要本地运行，可能需要配置密钥
  // secretId: process.env.TENCENT_SECRET_ID,
  // secretKey: process.env.TENCENT_SECRET_KEY
});
```

**注意**：`.env` 文件包含敏感信息，不要提交到代码仓库！

---

## 四、常见问题

### Q1: SecretId 和 SecretKey 有什么区别？

- **SecretId**: 密钥ID，用于标识密钥
- **SecretKey**: 密钥值，用于签名和认证
- 两者必须配对使用

### Q2: API Key 和 SecretId/SecretKey 有什么区别？

- **API Key (JWT Token)**: 
  - 用于HTTP API调用
  - 格式：JWT token
  - 用于RESTful接口调用

- **SecretId/SecretKey**:
  - 用于Node SDK调用云函数
  - 格式：两个独立的字符串
  - 用于 `wx-server-sdk` 的 `callFunction` 方法

### Q3: 为什么在微信开发者工具中不需要配置密钥？

微信开发者工具会自动从你的微信开发者账号中获取认证信息，无需手动配置。

### Q4: 测试时出现 "missing secretId or secretKey" 错误？

**原因**：当前运行环境没有配置腾讯云密钥。

**解决方法**：
1. **推荐**：在微信开发者工具中运行测试
2. **或者**：配置环境变量后本地运行
3. **或者**：在已配置云开发环境的服务器上运行

---

## 五、安全建议

1. **不要提交密钥到代码仓库**
   - 使用 `.env` 文件存储密钥
   - 将 `.env` 添加到 `.gitignore`

2. **定期轮换密钥**
   - 定期更换 SecretKey
   - 删除不再使用的密钥

3. **使用最小权限原则**
   - 只授予必要的权限
   - 使用子账号而非主账号

4. **妥善保管密钥**
   - 不要分享给他人
   - 不要在公开场合展示密钥

---

## 六、快速参考

### 环境ID
- **测试环境**: `test-juqi-3g1m5qa7cc2737a1`
- **生产环境**: `prod-juqi-7glu2m8qfa31e13f`（如果需要）

### 获取密钥的链接
- **腾讯云控制台**: https://console.cloud.tencent.com/
- **API密钥管理**: https://console.cloud.tencent.com/cam/capi
- **云开发控制台**: https://console.cloud.tencent.com/tcb

### 推荐运行方式
✅ **在微信开发者工具中运行**（最简单，无需配置）

---

**文档创建时间**: 2026-01-15
