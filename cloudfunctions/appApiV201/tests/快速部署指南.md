# 快速部署指南

## 部署方式选择

由于当前环境限制，推荐使用以下方式部署：

### 方式1: 使用微信开发者工具（最简单，推荐）

#### 部署 appApi 云函数

1. **打开微信开发者工具**
2. **打开项目**: `JUQI-APP`
3. **进入云开发**:
   - 点击工具栏"云开发"按钮
   - 或：工具 → 云开发 → 云开发控制台
4. **部署云函数**:
   - 左侧菜单 → "云函数"
   - 找到 `appApi` 云函数
   - 右键 → "上传并部署：云端安装依赖"
   - 等待部署完成（约1-2分钟）

#### 部署核心层云函数（JUQI-小程序项目）

1. **打开微信开发者工具**
2. **打开项目**: `JUQI-小程序`
3. **进入云开发控制台**
4. **依次部署以下云函数**:
   - `getUserList` - 右键 → "上传并部署：云端安装依赖"
   - `getDynsListV2` - 右键 → "上传并部署：云端安装依赖"
   - `publishDyn` - 右键 → "上传并部署：云端安装依赖"

---

### 方式2: 使用腾讯云控制台

1. **登录腾讯云控制台**
   - 访问: https://console.cloud.tencent.com/
   - 登录账号

2. **进入云开发**
   - 产品 → 云开发 → 云函数
   - 选择环境: `test-juqi-3g1m5qa7cc2737a1`

3. **部署每个云函数**:
   - 找到对应的云函数（如 `appApi`）
   - 点击"函数代码"
   - 点击"上传代码"
   - 选择"本地上传文件夹"
   - 选择对应的目录（如 `JUQI-APP/cloudfunctions/appApi/`）
   - 点击"部署"

---

## 部署顺序

### 第一步：部署核心层云函数（必须先部署）

这些云函数被 appApi 调用，必须先部署：

1. ✅ **getUserList**
   - 路径: `JUQI-小程序/cloudfunctions/getUserList/`
   - 修复: 添加 getCharging 导入

2. ✅ **getDynsListV2**
   - 路径: `JUQI-小程序/cloudfunctions/getDynsListV2/`
   - 修复: 修复 item 变量错误

3. ✅ **publishDyn**
   - 路径: `JUQI-小程序/cloudfunctions/publishDyn/`
   - 修复: 修复 JSON.parse 错误处理

### 第二步：部署 appApi 云函数

4. ✅ **appApi**
   - 路径: `JUQI-APP/cloudfunctions/appApi/`
   - 修复: 路由配置、数据格式转换

---

## 部署验证

部署完成后，运行测试验证：

```bash
cd JUQI-APP/cloudfunctions/appApi
export TENCENT_SECRET_ID="YOUR_SECRET_ID"
export TENCENT_SECRET_KEY="YOUR_SECRET_KEY"
export TCB_ENV_ID="test-juqi-3g1m5qa7cc2737a1"
node tests/run-all-tests.js
```

### 预期改进

部署后，以下接口应该能正常工作：

1. ✅ **appGetChargeList** - 获取充电列表
2. ✅ **appGetFavoriteList** - 获取收藏列表
3. ✅ **appPublishDyn** - 发布动态
4. ✅ **appGetInviteCount** - 获取邀请数量
5. ✅ **appGetUnreadCount** - 获取未读消息数
6. ✅ **appMarkMessagesRead** - 批量标记已读
7. ✅ **appSearchTopic** - 搜索话题

### 预期通过率

- **部署前**: 57.14% (48/84)
- **部署后**: 70%+ (59+/84)

---

## 注意事项

1. **环境确认**: 确保部署到测试环境 `test-juqi-3g1m5qa7cc2737a1`
2. **依赖安装**: 部署时选择"云端安装依赖"
3. **部署顺序**: 先部署核心层，再部署 appApi
4. **测试验证**: 部署后立即运行测试验证修复效果

---

**最后更新**: 2026-01-18
